<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Zerodium: PHP Git Software Supply Chain Attack | Sarthak's Blog</title><meta name=keywords content="php,exploits,security"><meta name=description content="How PHP's compromised git server led to backdoors in PHP source code"><meta name=author content="Sarthak Khattar"><link rel=canonical href=https://m0mosenpai.github.io/posts/4_zerodium/2021-10-18-zerodium/><link crossorigin=anonymous href=/assets/css/stylesheet.b183800e2cfbb62c3bce2b2ba56cdb2dd33af76c75cf4550173d5dfebd7c68a6.css integrity="sha256-sYOADiz7tiw7zisrpWzbLdM692x1z0VQFz1d/r18aKY=" rel="preload stylesheet" as=style><link rel=icon href=https://m0mosenpai.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://m0mosenpai.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://m0mosenpai.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://m0mosenpai.github.io/apple-touch-icon.png><link rel=mask-icon href=https://m0mosenpai.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Zerodium: PHP Git Software Supply Chain Attack"><meta property="og:description" content="How PHP's compromised git server led to backdoors in PHP source code"><meta property="og:type" content="article"><meta property="og:url" content="https://m0mosenpai.github.io/posts/4_zerodium/2021-10-18-zerodium/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-10-18T00:00:00+00:00"><meta property="article:modified_time" content="2021-10-18T00:00:00+00:00"><meta property="og:site_name" content="m0mosenpai"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zerodium: PHP Git Software Supply Chain Attack"><meta name=twitter:description content="How PHP's compromised git server led to backdoors in PHP source code"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://m0mosenpai.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Zerodium: PHP Git Software Supply Chain Attack","item":"https://m0mosenpai.github.io/posts/4_zerodium/2021-10-18-zerodium/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Zerodium: PHP Git Software Supply Chain Attack","name":"Zerodium: PHP Git Software Supply Chain Attack","description":"How PHP's compromised git server led to backdoors in PHP source code","keywords":["php","exploits","security"],"articleBody":"So I started a new part-time position this week and today was my first day - remote, ofcourse. I’m supposed to be a Malware Analyst - analyzing malwares and creating reports. It’s a new role for me since most of my experience has been in development, but I have always wanted to give core Security roles a try so I’m looking forward to this.\nBut anyways, point being - while researching today, I came across this hack that occurred in March earlier this year:\nAttackers spoofed 2 commits to the official PHP Repo - supposedly as “typo fixes” (which as we can see, clearly were not). These added lines looked for a new USER_AGENTT header in a request and executed whatever came after the string zerodium, as PHP code.\nI actually didn’t come across this news directly. I found some delibrately malicious programs during my research that had a very similar code in Python. They create a new endpoint via Flask and intercepted the USER_AGENTT header’s value to any request made.\nI was a bit confused when I first came across this exploit. Being the noob I am, I got hung up on the fact that they only ran the string as code when zerodium was present as a prefix. “Is there someone/some organization by the name of ‘Zerodium’ that gets to control what is executed?” I thought I was onto something big for a second.\nAnd then I Googled and realised it was an actual thing that had occurred in the past. What’s more, “Zerodium” was indeed the name of a company that bought exploits/bugs for large sums of money. However, they didn’t have anything to do with this - it was merely a troll from the attackers to use their name, claiming to have sold it to them.\nI wanted to mess around with it a bit so I replicated the Python implementation in another file, fired up the Flask server and sent some requests via Postman to see it in action. And sure enough:\nI suppose this is quite straightforward and something like this is not likely to happen so easily. Only reason this was even possible was because PHP’s git server got compromised. The actual saunce behind the whole attack probably lies there. The maintainers did switch completely to GitHub shortly after where organizational access and other security measures would prevent something like this from happening in the future.\nIn anycase, I thought this was something cool + it’s my first time doing this kind of research so I guess I was just a bit excited :P\nWell anyways, till next time.\n","wordCount":"436","inLanguage":"en","datePublished":"2021-10-18T00:00:00Z","dateModified":"2021-10-18T00:00:00Z","author":{"@type":"Person","name":"Sarthak Khattar"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://m0mosenpai.github.io/posts/4_zerodium/2021-10-18-zerodium/"},"publisher":{"@type":"Organization","name":"Sarthak's Blog","logo":{"@type":"ImageObject","url":"https://m0mosenpai.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://m0mosenpai.github.io/ accesskey=h title="0xMomo (Alt + H)">0xMomo</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://m0mosenpai.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://m0mosenpai.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://m0mosenpai.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://m0mosenpai.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://m0mosenpai.github.io/posts/>Posts</a></div><h1 class=post-title>Zerodium: PHP Git Software Supply Chain Attack</h1><div class=post-description>How PHP's compromised git server led to backdoors in PHP source code</div><div class=post-meta><span title='2021-10-18 00:00:00 +0000 UTC'>October 18, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Sarthak Khattar</div></header><div class=post-content><p>So I started a new part-time position this week and today was my first day - remote, ofcourse.
I&rsquo;m supposed to be a Malware Analyst - analyzing malwares and creating reports. It&rsquo;s a new role for me since
most of my experience has been in development, but I have always wanted to give core Security roles a try so
I&rsquo;m looking forward to this.</p><p>But anyways, point being - while researching today, I came across this hack that occurred in March earlier this year:</p><p><img loading=lazy src=/static/4_zerodium/php-rce.jpg alt=spoofed_commits></p><p>Attackers spoofed 2 commits to the official PHP Repo - supposedly as &ldquo;typo fixes&rdquo; (which as we can see, clearly were not).
These added lines looked for a new <code>USER_AGENTT</code> header in a request and executed whatever came after the string <code>zerodium</code>, as PHP code.</p><p>I actually didn&rsquo;t come across this news directly. I found some delibrately malicious programs during my research that had a very similar code in Python. They create a new endpoint via Flask and intercepted the <code>USER_AGENTT</code> header&rsquo;s value to any request made.</p><p>I was a bit confused when I first came across this exploit. Being the noob I am, I got hung up on the fact that they only ran
the string as code when <code>zerodium</code> was present as a prefix. <em>&ldquo;Is there someone/some organization by the name of &lsquo;Zerodium&rsquo; that gets to control what is executed?&rdquo;</em> I thought I was onto something big for a second.</p><p>And then I Googled and realised it was an actual thing that had occurred in the past. What&rsquo;s more, &ldquo;Zerodium&rdquo; was indeed the name of a company that bought exploits/bugs for large sums of money. However, they didn&rsquo;t have anything to do with this - it was merely a troll from the attackers to use their name, claiming to have sold it to them.</p><p><img loading=lazy src=/static/4_zerodium/exploit.png alt=exploit>
I wanted to mess around with it a bit so I replicated the Python implementation in another file, fired up the Flask server and sent some requests via Postman to see it in action. And sure enough:</p><p><img loading=lazy src=/static/4_zerodium/execution.png alt=exec></p><p>I suppose this is quite straightforward and something like this is not likely to happen so easily. Only reason this was even possible was because PHP&rsquo;s git server got compromised. The actual saunce behind the whole attack probably lies there. The maintainers did switch completely to GitHub shortly after where organizational access and other security measures would prevent something like this from happening in the future.</p><p>In anycase, I thought this was something cool + it&rsquo;s my first time doing this kind of research so I guess I was just a bit excited :P</p><p>Well anyways, till next time.</p><p><img loading=lazy src=/static/4_zerodium/laughing.gif alt=laughing></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://m0mosenpai.github.io/tags/php/>php</a></li><li><a href=https://m0mosenpai.github.io/tags/exploits/>exploits</a></li><li><a href=https://m0mosenpai.github.io/tags/security/>security</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://m0mosenpai.github.io/>Sarthak's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>